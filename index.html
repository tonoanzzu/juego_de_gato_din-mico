<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Gato</title>
</head>

<body>
    <gato-game></gato-game>
</body>
<script>
    class GatoGame extends HTMLElement {
        constructor() {
            super();
        }

        verificacionGlobal1() {
            // independientemente de la longitud del gato, obtengo el arreglo de TODOS los botones
            let arrayButtons = this.contenido.children;

            //el "gane" se obtiene poniendo en fila poniendo en fila continua X o O, 
            //por le que el numero de elementos continues es = a la raiz cuadrada de la longitud del cuadrado
            let gane = Math.sqrt(arrayButtons.length);
            let ganeDiagonalSuperioraInferiorX = 0,
                ganeDiagonalSuperioraInferiorO = 0;
            let ganeDiagonalInferioraSuperiorX = 0,
                ganeDiagonalInferioraSuperiorO = 0;
            let ganeHorizontalX = 0,
                ganeHorizontalO = 0;
            let ganeVerticalX = 0,
                ganeVerticalO = 0;
            let temporalElement;
            let ganaX = false;
            let ganaO = false;
            let ganeVirtual = gane - 1; //declaro 2 variables parecidas, porque en un caso en especifico realizo modificaciones a su valor durante el proceso
            let iteracion = 0;
            let ganeMenos1 = ganeVirtual; //declaro 2 variables parecidas, porque en un caso en especifico realizo modificaciones a su valor durante el proceso
            //verificacion diagonal superior a inferior
            for (let j = 0; j < arrayButtons.length; j++) {

                temporalElement = arrayButtons[j];

                if (temporalElement.value === 'X') {
                    ganeDiagonalSuperioraInferiorX++;
                }
                if (temporalElement.value === 'O') {
                    ganeDiagonalSuperioraInferiorO++;
                }

                j = j + gane;
            }
            //verificacion diagonal superior a inferior
            for (let k = 0; k < gane; k++) {

                temporalElement = arrayButtons[ganeVirtual];

                if (temporalElement.value === 'X') {
                    ganeDiagonalInferioraSuperiorX++;
                }
                if (temporalElement.value === 'O') {
                    ganeDiagonalInferioraSuperiorO++;
                }

                ganeVirtual = gane + (ganeVirtual - 1);

            }
            //verificacion horizontal
            for (let i = 0; i < gane; i++) {
                for (let j = 0; j < gane; j++) {
                    //el elemento iteracion continua siendo un valor progresivo, independiente a j e i
                    temporalElement = arrayButtons[iteracion];

                    switch (temporalElement.value) {
                        case 'X':
                            ganeHorizontalX++;
                            break;
                        case 'O':
                            ganeHorizontalO++;
                            break;
                    }

                    if (ganeHorizontalX === gane) {
                        ganaX = true;
                    }

                    if (ganeHorizontalO === gane) {
                        ganaO = true;
                    }

                    if (ganaX || ganaO) {
                        break;
                    }

                    iteracion++;
                }

                if (ganeHorizontalX === gane || ganeHorizontalO === gane) {
                    break;
                }

                ganeHorizontalX = 0;
                ganeHorizontalO = 0;

            }

            //verificacion vertical
            for (let j = 0; j < gane; j++) {

                for (let i = j; i < arrayButtons.length; i++) {

                    temporalElement = arrayButtons[i];

                    switch (temporalElement.value) {
                        case 'X':
                            ganeVerticalX++;
                            break;
                        case 'O':
                            ganeVerticalO++;
                            break;
                    }

                    if (ganeVerticalX === gane) {
                        ganaX = true;
                    }

                    if (ganeVerticalO === gane) {
                        ganaO = true;
                    }

                    if (ganaX || ganaO) {
                        break;
                    }

                    i = i + ganeMenos1;
                }

                if (ganaX || ganaO) {
                    break
                }

                ganeVerticalX = 0;
                ganeVerticalO = 0;

            }
            //revisiones de simbolos en linea diagonal
            if (ganeDiagonalSuperioraInferiorX === gane || ganeDiagonalInferioraSuperiorX === gane) {
                ganaX = true;
            }

            if (ganeDiagonalSuperioraInferiorO === gane || ganeDiagonalInferioraSuperiorO === gane) {
                ganaO = true;
            }

            //verificacion si alguno de los dos simbolos gana
            if (ganaX) {
                alert('gana X !');
                this.finJuego();
            }

            if (ganaO) {
                alert('gana O !');
                this.finJuego();
            }

        }

        finJuego() {
            let arrayButtons = this.contenido.children;
            for (let i = 0; i < arrayButtons.length; i++) {
                arrayButtons[i].disabled = true;
            }
        }

        connectedCallback() {

            //declaracion del shadow root
            let shadowRoot = this.attachShadow({
                mode: 'open'
            });
            let noCasillas;
            let valorValido = true;
            //solicitud de un numero valido para generar regilla
            while (valorValido) {

                noCasillas = prompt("Numero de casillas por lado", 3) || 3;
                if (typeof noCasillas === 'string') {
                    noCasillas = parseInt(noCasillas)
                }

                if (typeof noCasillas === 'number' && noCasillas >= 3) {
                    valorValido = false;
                    break;
                } else {
                    alert('elige un numero mayor o igual a 3')
                }
            }

            let botones = [];
            let contenido = document.createElement('div');
            contenido.id = 'contenido';
            contenido.style = 'display: flex; background: gray;width: ' + noCasillas + '00px;flex-wrap: wrap;';

            if (noCasillas != null) {

                for (let i = 0; i < noCasillas; i++) {

                    for (let j = 0; j < noCasillas; j++) {
                        let virtualBtn = document.createElement('button');
                        virtualBtn.innerHTML = '';
                        virtualBtn.value = '';
                        virtualBtn.style = 'width: 100px;';
                        virtualBtn.addEventListener('click', (function() {

                            let elementoSet = virtualBtn.id;
                            let nuevoValor = prompt('Elige valor O รณ X', '');
                            let casilla;

                            if (nuevoValor === 'o' || nuevoValor === 'O') {
                                virtualBtn.value = 'O';
                                virtualBtn.innerText = 'O';
                                virtualBtn.disabled = true;
                                this.verificacionGlobal1();

                            } else if (nuevoValor === 'x' || nuevoValor === 'X') {
                                virtualBtn.value = 'X';
                                virtualBtn.innerText = 'X';
                                virtualBtn.disabled = true;
                                this.verificacionGlobal1();

                            } else {
                                alert('valor no valido');
                            }

                        }).bind(this));

                        botones.push(virtualBtn);
                        contenido.appendChild(virtualBtn);
                    }

                }

            }
            this.contenido = contenido
            shadowRoot.appendChild(contenido);
        }

        disconnectedCallback() {
            console.log('disconnected!');
        }

        attributeChangedCallback(name, oldVal, newVal) {
            console.log(`Attribute: ${name} changed!`);
        }
    }

    window.customElements.define('gato-game', GatoGame);
</script>

</html>